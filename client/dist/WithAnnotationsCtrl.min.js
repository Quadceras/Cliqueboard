angular.module("twork",["ngRoute","twork.login","twork.signup","twork.main","ui.materialize"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/login",{templateUrl:"login/loginView.html",controller:"loginController"}).when("/signup",{templateUrl:"login/signupView.html",controller:"signupController"}).when("/",{templateUrl:"main/mainView.html"})}]).run(["$rootScope","$location",function(a,b){a.$on("$routeChangeStart",function(c,d,e){a.loggedInUser||"/signup"===b.path()||b.path("/login")})}]),angular.module("twork.main",[]).controller("whiteboardController",["$scope",function(a){a.name="whiteboard",a.color="#000000",a.init=function(){this.canvas=document.createElement("canvas"),this.canvas.height=$(".canvas").height(),this.canvas.width=$(".canvas").width(),document.getElementsByClassName("canvas")[0].appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="solid",this.ctx.strokeStyle=a.color,this.ctx.lineWidth=1,this.ctx.lineCap="round";var b=this;$("#colorpicker").change(function(){a.color=$("#colorpicker").val(),b.ctx.strokeStyle=a.color})},a.draw=function(a,b,c,d){this.ctx.strokeStyle=d,"dragstart"===c?(this.ctx.beginPath(),this.ctx.moveTo(a,b)):"drag"===c?(this.ctx.lineTo(a,b),this.ctx.stroke()):this.ctx.closePath()},a.init(),a.socket=io(),a.socket.on("draw",function(b){a.draw(b.x,b.y,b.type,b.color)}),a.socket.on("clear",function(b){a.remoteClear()}),$("canvas").live("drag dragstart dragend",function(b){var c=b.handleObj.type,d=a.color,e=$(this).offset();b.offsetX=b.pageX-e.left,b.offsetY=b.pageY-e.top;var f=b.offsetX,g=b.offsetY;a.draw(f,g,c,d),a.socket.emit("drawClick",{x:f,y:g,type:c,color:d})}),a.remoteClear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},a.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),a.socket.emit("clear")}}]).controller("chatController",["$scope","$rootScope",function(a,b){b.userData;a.socket=io();var c=b.loggedInUser;a.socket.on("connect",function(){a.socket.emit("adduser",c)}),a.socket.on("updateusers",function(a){$("#users").empty(),$.each(a,function(a,b){$("#users").append("<div>"+b+"</div>")})}),a.socket.on("updatechat",function(a,b){$("#conversation").append("<b>"+a+":</b> "+b+"<br>")}),$(function(){$("#datasend").click(function(){var b=$("#data").val();$("#data").val(""),a.socket.emit("sendchat",b)}),$("#data").keypress(function(a){13==a.which&&($(this).blur(),$("#datasend").focus().click())})})}]).controller("tasksController",["$scope","$http","Tasks",function(a,b,c){angular.extend(a,c),a.socket=io(),a.socket.on("add",function(b){a.$apply(function(){a.tasks[b._id]=b,console.log("ADDED:",b)})}),a.socket.on("delete",function(b){a.$apply(function(){delete a.tasks[b]})}),a.task={name:null,date:null,urgency:null},a.init=function(){b.get("/tasks").then(function(b){b.data.forEach(function(b){a.tasks[b._id]||(a.tasks[b._id]=b)}),console.log("Task GET successful:",a.tasks)})["catch"](function(a){console.error("Task GET error:",a)})},a.init(),a.addTask=function(c,d,e){d=void 0!==d?a.formatDate(d,!0):"N/A",e=e||"Not Urgent",a.task.name=null,a.task.date=null,a.task.urgency=null,a.createTask.$setPristine();var f={name:c,created:a.formatDate(new Date(Date.now()),!1),due:d,urgency:e,complete:!1};b.post("/tasks",f).then(function(b){console.log("Task POST successful:",b),a.tasks[b.data._id]||(a.socket.emit("addTask",b.data),a.tasks[b.data._id]=b.data)})["catch"](function(a){console.error("Task POST error:",a)})},a.toggle=function(a){a.complete?(a.complete=!1,b.put("/tasks/"+a._id+"/incomplete").then(function(a){console.log("Task PUT successful")})["catch"](function(a){console.error("Task PUT error:",a)})):(a.complete=!0,b.put("/tasks/"+a._id+"/complete").then(function(a){console.log("Task PUT successful")})["catch"](function(a){console.error("Task PUT error:",a)}))},a["delete"]=function(c){b["delete"]("/tasks/"+c._id).then(function(b){a.socket.emit("deleteTask",c._id),console.log("Task DELETE successful")})["catch"](function(a){console.error("Task DELETE error:",a)}),delete a.tasks[c._id]}}]).factory("Tasks",["$http",function(a){var b={tasks:{},formatDate:function(a,b){var c=new Date(a),d=c.getDate(),e=c.getMonth()+1+"/",f=c.getHours()>12?c.getHours()-12+":":c.getHours()+":",g=c.getMinutes().toString().length<2?"0"+c.getMinutes():c.getMinutes(),h=b?e+d:e+d+" at "+f+g;return h}};return b}]),angular.module("twork.login",[]).controller("loginController",["$scope","$rootScope","logInUserInfo",function(a,b,c){angular.extend(a,c)}]).factory("logInUserInfo",["$http","$location","$rootScope",function(a,b,c){var d,e=function(e,f){d=e;var g={username:e,password:f};return a.post("/login",g).then(function(a,e){c.loggedInUser=d,b.path("/")})["catch"](function(a){b.path("/login")})},f=function(){c.loggedInUser=void 0,b.path("/login")};return{requestUser:e,holdUserName:d,logoutUser:f}}]),angular.module("twork.signup",[]).controller("signupController",["$scope","signUpInfo",function(a,b){angular.extend(a,b)}]).factory("signUpInfo",["$http","$location","$rootScope",function(a,b,c){var d,e=function(e,f,g){d=f;var h={email:e,username:f,password:g};return a.post("/signup",h).then(function(a,e){c.loggedInUser=d,b.path("/")})["catch"](function(a){b.path("/signup")})};return{createUser:e,holdUserName:d}}]);